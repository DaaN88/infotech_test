<?php

declare(strict_types=1);

/**
 * Перераспределяет годы выпуска книг, чтобы ТОП-10 отличался по годам.
 */
class m260220_160000_reassign_book_years extends CDbMigration
{
    public function up()
    {
        $mapping = [
            1 => 2024,
            2 => 2023,
            3 => 2024,
            4 => 2024,
            5 => 2022,
            6 => 2024,
            7 => 2024,
            8 => 2024,
            9 => 2024,
            10 => 2023,
            11 => 2024,
            12 => 2024,
            13 => 2024,
            14 => 2023,
            15 => 2024,
            16 => 2024,
            17 => 2023,
            18 => 2024,
            19 => 2024,
            20 => 2022,
        ];

        foreach ($mapping as $id => $year) {
            $this->update('books', ['year' => $year], 'id=:id', [':id' => $id]);
        }
    }

    public function down()
    {
        // возвращаем базовое распределение (2024 основное, 2023 для нескольких)
        $fallback = [
            1 => 2024,
            2 => 2023,
            3 => 2024,
            4 => 2024,
            5 => 2023,
            6 => 2024,
            7 => 2024,
            8 => 2024,
            9 => 2024,
            10 => 2023,
            11 => 2024,
            12 => 2024,
            13 => 2024,
            14 => 2023,
            15 => 2024,
            16 => 2024,
            17 => 2023,
            18 => 2024,
            19 => 2024,
            20 => 2024,
        ];

        foreach ($fallback as $id => $year) {
            $this->update('books', ['year' => $year], 'id=:id', [':id' => $id]);
        }
    }
}
